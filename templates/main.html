## coding=utf-8
<%namespace name='static' file='static_content.html'/>
<%!
from django.utils.http import urlquote_plus
from django.utils.translation import ugettext as _
from django.utils.translation import get_language_bidi
from microsite_configuration import microsite
from microsite_configuration import page_title_breadcrumbs

dir_rtl = 'rtl' if get_language_bidi() else 'ltr'
%>
<!DOCTYPE html>
<!--[if lte IE 9]><html class="ie ie9 lte9" lang="${LANGUAGE_CODE}"><![endif]-->
<!--[if !IE]><!--><html lang="${LANGUAGE_CODE}"><!--<![endif]-->
<head dir="${dir_rtl}">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    % if responsive:
    <meta name="viewport" content="width=device-width, initial-scale=1">
    % endif
    
    <%
        ## We override this template to insert the RSS feed and add the platform node name.
    %>
    <%! import platform %>
    <meta name="platform.node" CONTENT="${platform.node()}">
    <link rel="alternate" type="application/rss+xml" title="${_('FUN courses RSS feed')}" href="${reverse('fun-courses-feed')}" />

## Define a couple of helper functions to make life easier when
## embedding theme conditionals into templates. All inheriting
## templates have access to these functions, and we can import these
## into non-inheriting templates via the %namespace tag.
<%def name="theme_enabled()">
  <% return settings.FEATURES.get("USE_CUSTOM_THEME", False) %>
</%def>

<%def name="stanford_theme_enabled()">
  <%
    if not theme_enabled():
      return False

    return getattr(settings, "THEME_NAME", None) == "stanford"
  %>
</%def>

## this needs to be here to prevent the title from mysteriously appearing in the body, in one case
<%def name="pagetitle()" />
  <%block name="title">
      <title>
       ${page_title_breadcrumbs(self.pagetitle())} - France Université Numérique
      </title>
  </%block>

  % if not allow_iframing:
      <script type="text/javascript">
        /* immediately break out of an iframe if coming from the marketing website */
        (function(window) {
          if (window.location !== window.top.location) {
            window.top.location = window.location;
          }
        })(this);
      </script>
  % endif

  <script type="text/javascript" src="/jsi18n/"></script>

  <link rel="icon" type="image/x-icon" href="${static.url(microsite.get_value('favicon_path', settings.FAVICON_PATH))}" />

  <%static:css group='style-vendor'/>
  <%static:css group='style-main'/>

  <%static:js group='main_vendor'/>

  <%block name="headextra"/>

<%
  if theme_enabled():
    header_extra_file = 'theme-head-extra.html'
    header_file = 'theme-header.html'
    google_analytics_file = 'theme-google-analytics.html'
    footer_file = 'theme-footer.html'

    style_overrides_file = None

  else:
    header_extra_file = None
    header_file = microsite.get_template_path('navigation.html')
    google_analytics_file = microsite.get_template_path('google_analytics.html')
    footer_file = microsite.get_template_path('footer.html')

    style_overrides_file = microsite.get_value('css_overrides_file')
%>

  % if header_extra_file:
    <%include file="${header_extra_file}" />
  % endif

  <%include file="widgets/optimizely.html" />
  <%include file="widgets/segment-io.html" />

  <meta name="path_prefix" content="${EDX_ROOT_URL}">

  % if not course:
    <%include file="${google_analytics_file}" />
  % endif

  <%include file="widgets/segment-io.html" />


% if style_overrides_file:
  <link rel="stylesheet" type="text/css" href="${static.url(style_overrides_file)}" />
% endif

% if settings.ENVIRONMENT == 'ketch':
  <link rel="stylesheet" type="text/css" href="${static.url('fun/css/teacher-sandbox.css')}" />
% endif

<!-- Cookie banner -->
<link rel="stylesheet" type="text/css" href="${static.url('themes/fun/css/cookie-banner.css')}" />

<script src="${static.url('themes/fun/js/cookie-banner.js')}"></script>
</head>

<body class="<%block name='bodyclass'/> lang_${LANGUAGE_CODE}">

 <div id="cookie-banner" style="display:none">
   <div class="row">
   <div class="left">
       <div class="text">
           ${_("By continuing browsing the france-universite-numerique-mooc.fr site, you accept the use of cookies to enhance your user experience")}.
       </div>
       <div class="link">
           <a href="/privacy">&gt; ${_("Read more")}</a>
       </div>
    </div>
    <div class="right">
        <a href="#" class="cookie-banner-button">${_("I agree")}</a>
    </div>
    </div>
 </div>

    % if not disable_header:
        <%include file="${header_file}" />
    % endif

  <%include file="mathjax_accessible.html" />

    % if not disable_footer:
        <%block name="footer">
          ## Can be overridden by child templates wanting to hide the footer.
          <%
            if theme_enabled() and not is_microsite():
              footer_file = 'theme-footer.html'
            elif settings.FEATURES.get('IS_EDX_DOMAIN', False) and  settings.FEATURES.get('ENABLE_FOOTER_V3', True) and not is_microsite():
              footer_file = microsite.get_template_path('footer-edx-v3.html')
            elif settings.FEATURES.get('IS_EDX_DOMAIN', False) and not is_microsite():
              footer_file = microsite.get_template_path('footer-edx-v2.html')
            else:
              footer_file = microsite.get_template_path('footer.html')
          %>
          <%include file="${footer_file}" />
        </%block>
    % endif

  <div class="content-wrapper" id="content">
    ${self.body()}
    <%block name="bodyextra"/>
  </div>

% if not suppress_toplevel_navigation:
  <%include file="${footer_file}" />
% endif

  <script>window.baseUrl = "${settings.STATIC_URL}";</script>
  <%static:js group='application'/>
  <%static:js group='module-js'/>

  <%block name="js_extra"/>
</body>
</html>

<%def name="login_query()">${
  u"?course_id={0}&enrollment_action={1}".format(
    html.escape(course_id),
    html.escape(enrollment_action)
  ) if course_id and enrollment_action else ""
}</%def>


